# Encoding Format

## Overview

Convex implements a standard data encoding format that represents any valid Convex data values.

## Basic Rules

### Cells

The fundamental data objects that are encoded are called Cells.

Cells may contain other Cells (directly by embedding or indirectly by reference) and therefore a top-level cell represents a DAG of Cell values. 

### Encoding

The Encoding MUST be a sequence of bytes.

Any given Cell MUST map to one and only one valid encoding. 

Any two distinct (non-identical) Cell MUST map to a different Encoding

The Encoding MUST have a maximum length of 8191 bytes. This ensure that an Encoded value will always fit within a reasonable fixed size buffer.

### Value ID

The Value ID of a Cell is defined to be the unique SHA3-256 hash of the Encoding.
Cell data value to which they refer.

### Valid and Invalid Encodings

A sequence of bytes is a Valid Encoding is there exists a Cell which produces the same sequence of bytes as its Encoding.

A sequence of bytes is an Invalid Encoding if there is no Cell which produces the same sequence of bytes as its Encoding.

Implementations MUST be able to reconstruct a Cell from any Valid Encoding.

Implementations MUST recognise an Invalid Encoding, and in particular:

- Implementations MUST recognise an Invalid Coding if the byte sequence contains additional bytes after the end of a Valid Encoding
- Implementations MUST recognise an Invalid Encoding if the byte sequence terminates before enough bytes are obtained to complete a Valid Encoding 

### References 

A Cell encoding may contain a reference to another cell by including the Value ID of the referenced Cell. A reference is treated as if the referenced cell was directly included as part of the Cell Encoding.

### CVM Values

Some Cells represent valid CVM values, i.e. are permitted as first class values in the Convex Virtual Machine. 

Not all Cells represent true CVM values, since Cells may also be used for internal data structures within larger CVM values, or represent values that are only used outside the CVM.

## Encoding Format

### Tag Byte

The first byte of the Encoding is defined to be the Tag, which designates the type of the data value, and determines how the remainder of the Encoding should be interpreted.

Implementations MUST recognise an Invalid Encoding if the Tag byte is not recognised as one defined in this document.


### Embedding

A cell value may be defined as Embedded in which case its Encoding will be directly inserted in the Encoding of the containing Cell.

And Embedded Cell MUST have an Encoding of 140 bytes or less.

 